function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("mod_skillsaudit/skillsaudit",["jquery","core/ajax"],function(d,a){var b={showDialog:function showDialog(a,b,c,e){d("#dlg_title").html(a);d("#dlg_body").html(b);if(c){c()}if(e){for(var f="",g=0,h;g<e.length;g++){h=e[g];f+="<button class=\"btn btn-secondary\" id=\"dlg_btn_"+h.id+"\" "+(h.close?"data-dismiss=\"modal\"":"")+">"+h.text+"</button> "}d("#dlg_footer").html(f);for(var g=0,h;g<e.length;g++){h=e[g];if(h.onClick){d("#dlg_btn_"+h.id).click(h.onClick)}}}else{d("#dlg_footer").html("<button class=\"btn btn-secondary\" id=\"dlg_btn_close\" data-dismiss=\"modal\">Close</button>")}d("#dlg").show().modal()},trackinit:function trackinit(c,e,f,g){function h(){function c(){d(".rating_td").click(function(c){parts=c.currentTarget.id.split("_");var e=parts[3];if(!e){return}var f=parts[2];b.showDialog("Summary","Loading...",null,[{id:"send",text:"Send message",close:!0,onClick:function onClick(){var b=d(".rating_comment_editor").val(),c=d(".rating_comment_editor").attr("id"),e=c.split("_"),f=e[2],g=e[4],h=e[3],i=a.call([{methodname:"mod_skillsaudit_post_feedback",args:{cmid:f,skillid:g,userid:h,comment:b}}]);i[0].done(function(a){d(".latest_comment").html(a)})}},{id:"close",text:"Close",close:!0}]);var h=a.call([{methodname:"mod_skillsaudit_get_activity_summary",args:{cmid:g,userid:e,skillid:f}}]);h[0].done(function(b){d("#dlg_body").html(b);d(".btn_delete_feedback").click(function(b){var c=b.currentTarget.id.split("_")[3],e=a.call([{methodname:"mod_skillsaudit_delete_feedback",args:{cmid:g,feedbackid:c}}]);e[0].done(function(a){d("#teacher_feedback_"+a).remove()})})})})}d("th.r_sortable").click(function(a){var b=d(a.currentTarget);if("asc"==b.data("order")){b.data("order","desc")}else{b.data("order","asc")}var e=b.data("order"),f=d(a.currentTarget).parents("table").eq(0),g=f.find("tbody"),h=[];g.find("tr").each(function(a,b){h.push(b.outerHTML)});g.html("");var j=d(a.currentTarget).data("col");h.sort(function(c,a){var b=d(c).find("td[data-col='"+j+"']").data("sortable"),f=d(a).find("td[data-col='"+j+"']").data("sortable");if("string"==typeof b){if("asc"==e){return b.localeCompare(f)}return f.localeCompare(b)}if("asc"==e){return b-f}return f-b});for(var k=0;k<h.length;k++){g.append(h[k])}c()});c()}function i(){var b=d("#select_group").val(),c=d("#highlight").val(),e=a.call([{methodname:"mod_skillsaudit_update_tracker",args:{cmid:g,groupid:b,highlight:c}}]);e[0].done(function(a){d("#tracker_table").html(a);h()})}d("#btn_update_progress_tracker").click(function(){i()});d("#select_group").change(i);d("#highlight").change(i);d("#autorefresh").change(function(){var a=1e3*d(this).val();clearInterval(b.trackUpdateInterval);if(0<a){b.trackUpdateInterval=setInterval(i,a)}});h()},viewinit:function viewinit(c,e,f,g){var n=0,o=-1;function h(c){var e=c.currentTarget.id.replace("btn_delete_","");b.showDialog("Confirm delete","Are you sure you want to delete this rating?<p>If you press save, there's no way to undo this action</p>",null,[{id:"save",text:"Save",close:!0,onClick:function onClick(){var b=a.call([{methodname:"mod_skillsaudit_delete_rating",args:{cmid:g,ratingid:e}}]);b[0].done(function(a){if(a.ratingID==e){d("#rating_"+e).remove()}d(".skillsaudit_user_summary").html(a.summaryHtml);var b=d("#skill_row_"+o+" .minithumb").last().attr("data-confidence");if(!b)b=0;var c=Math.round(120*b/100);d("#conf_ind_"+o).css({width:b+"%",background:"linear-gradient(to right,red,hsl("+c+",100%,50%)"});var f=d("#skill_row_"+o).find(".rating").length;d("#rating_stats_"+o+" .rating_count").text(f);d("#skill_row_"+o+" .latest_rating_time").text("Last rated: today")})}},{id:"cancel",text:"Cancel",close:!0}])}function i(c){var e=c.currentTarget.id.replace("btn_clear_","");b.showDialog("Confirm clear","Are you sure you want to clear this comment?<p>If you press save, there's no way to undo this action</p>",null,[{id:"clear",text:"Clear",close:!0,onClick:function onClick(){var b=a.call([{methodname:"mod_skillsaudit_clear_rating",args:{cmid:g,ratingid:e}}]);b[0].done(function(a){if(a==e){d("#rating_"+e+" .rating_comment").remove()}})}},{id:"cancel",text:"Cancel",close:!0}])}d(".btn_delete").click(h);d(".btn_clear").click(i);function j(a){d("#main_indicator").css({left:a+"%"}).find(".thumb").css({"background-color":"hsl("+120*a/100+",100%,50%)",transform:"rotate("+(180-180*a/100)+"deg)"})}function k(a){o=a;d(".skill_row").not("#skill_row_"+a).fadeOut();d("#skill_row_"+a+" .ratings").slideDown();n=0;if(e&&e[a]&&e[a].confidence)n=e[a].confidence;var b=d("#skill_description_"+a).text(),c=d("#skill_row_"+a+" .skillnumber").text();d(".current_lo_title").text(c);d(".current_lo").text(b);j(n);d("#controls, #skill_row_"+a).fadeIn()}function l(b){var g=Math.round(120*n/100);d("#conf_ind_"+o).css({width:n+"%",background:"linear-gradient(to right,red,hsl("+g+",100%,50%)"}).parent().attr("title",n+"%");e[o].confidence=n;var j=d("#id_comment").val();if(("undefined"==typeof tinyMCE?"undefined":_typeof(tinyMCE))!==void 0){try{j=tinyMCE.get("id_comment").getContent()}catch(a){}}var k=a.call([{methodname:"mod_skillsaudit_save_confidence",args:{courseid:c,skillid:o,confidence:n,comment:j,auditid:f}}]);k[0].done(function(a){d("#skill_row_"+o+" .ratings .new_ratings").append(a.ratingHtml);d("#skill_row_"+o+" .skillnumber").addClass("skill_included_yes");d(".btn_delete").unbind("click").click(h);d(".btn_clear").unbind("click").click(i);d(".skillsaudit_user_summary").html(a.summaryHtml);var c=d("#skill_row_"+o).find(".rating").length;d("#rating_stats_"+o+" .rating_count").text(c);d("#skill_row_"+o+" .latest_rating_time").text("Last rated: today");if(b)b()})}d("#btn_save_confidence").click(function(){l(m)});d(".skill_row").click(function(a){var b=a.currentTarget.id.replace("skill_row_","");k(b)});function m(){d("#controls").fadeOut();d("#skill_row_"+o+" .ratings").slideUp();d(".skill_row").fadeIn();o=-1}d("#btn_show_all").click(m);d("#btn_show_next").click(function(){l(function(){var a=d("#skill_row_"+o).next().attr("id");m();if(a){k(a.replace("skill_row_",""))}})});d("#controls").hide();d(".btn_hide_comments").click(function(){d("#skill_row_"+o+" .ratings").slideUp();return!1});d(".btn_cancel").click(function(){m();return!1});var p=d(".btn_confidence");d(".btn_anim").click(function(a){var b=a.currentTarget.id.replace("btn_confidence_","");n=Math.round(100*b/(p.length-1));j(n)})},forminit:function forminit(c){d("#id_selectall").click(function(){d(".skill_included").removeClass("skill_included_no").addClass("skill_included_yes");f()});d("#id_selectnone").click(function(){d(".skill_included").removeClass("skill_included_yes").addClass("skill_included_no");f()});d("#id_deleteunused").click(function(){b.showDialog("Confirm delete","Are you sure you want to delete all skills that aren't used in this course?<p>If you press save, there's no way to undo this action</p>",null,[{id:"delete",text:"Delete",close:!0,onClick:function onClick(){var b=[];d(".skill_included_no").each(function(a,c){b.push(c.id.replace("skill_included_",""))});var e=a.call([{methodname:"mod_skillsaudit_delete_unused_skills",args:{courseid:c,skillids:b.join(",")}}]);e[0].done(function(a){for(var b=a.split(","),c=0;c<b.length;c++){d("#skill_row_"+b[c]).remove()}})}},{id:"cancel",text:"Cancel",close:!0}])});function f(){var a="";d(".skill_included_yes").each(function(b,c){a=a+c.id.replace("skill_included_","")+","});a=a.replace(/,$/,"");d("input[name='skills']").val(a)}function g(a){var b=d(a.target);if(b.hasClass("skill_included_yes")){b.removeClass("skill_included_yes");b.addClass("skill_included_no")}else{b.removeClass("skill_included_no");b.addClass("skill_included_yes");url=b.attr("src")}f()}function h(f){var e=d(f.target),g=0;while(!e.attr("id").match(/skill_row_/)){if(4<g++)break;e=e.parent()}var h=e.attr("id").replace("skill_row_",""),i=e.find(".skill_number").text(),j=e.find(".skill_description").text(),k=e.find(".skill_help_link").attr("href");b.showDialog("Edit skill","<h3>Note:</h3>Editing a skill here will affect all skills audits that include that skill in this course<div class=\"form-group\"><label for=\"skill_edit_number\"><h4>Spec. number:</h4></label><input class=\"form-control\" id=\"skill_edit_number\" value=\""+i+"\"></div><div class=\"form-group\"><label for=\"skill_edit_description\"><h4>Description:</h4></label><input class=\"form-control\" id=\"skill_edit_description\" value=\""+j+"\"><label for=\"skill_edit_link\"><h4>Help link:</h4></label><input class=\"form-control\" id=\"skill_edit_link\" value=\""+k+"\"><h3>Warning</h3>Deleting this skill cannot be undone. It will remove the skill from this audit and any others in this course.",null,[{id:"save",text:"Save",close:!0,onClick:function onClick(){j=d("#skill_edit_description").val();i=d("#skill_edit_number").val();helpLink=d("#skill_edit_link").val();var b=a.call([{methodname:"mod_skillsaudit_edit_skill",args:{courseid:c,skillid:h,number:i,description:j,link:helpLink}}]);b[0].done(function(){e.find(".skill_description").text(j);if(0<helpLink.length){i="<span class=\"info_icon\"></span>"+i}e.find(".skill_help_link").attr("href",helpLink).html(i)})}},{id:"delete",text:"Delete",close:!0,onClick:function onClick(){var b=a.call([{methodname:"mod_skillsaudit_delete_skill",args:{courseid:c,skillid:h}}]);b[0].done(function(){d("#skill_row_"+h).remove()})}},{id:"cancel",text:"Cancel",close:!0}])}d(".skill_included").click(g);d(".skill_row").dblclick(h);d("#id_addnew").click(function(){var e=[];b.showDialog("Check new skills","<div id=\"skills_preview\">",function(){var a=d("#id_newskills").val().split("\n"),b="<table class=\"generaltable\"><tr><th>Number</th><th>Description</th><th>Help link</th></tr>";d.each(a,function(a,c){var d=c.trim().match(/^(.*?)\s+(.*?)\s*(https?:\/\/.*)?$/m),f="",g="",h=c;if(d&&2<d.length){f=d[1].trim();h=d[2].trim();if(3<d.length&&d[3]){g=d[3].trim()}}var i="";if(0<g.length){i+="<a href=\""+g+"\" target=\"_blank\"><span class=\"info_icon\"></span></a>"}e.push({number:f,description:h,link:g});b+="<tr><td>"+f+"</td><td>"+h+"</td><td>"+i+"</td></tr>"});b+="</table>";d("#skills_preview").html(b)},[{id:"add",text:"Add",close:!0,onClick:function onClick(){var b=a.call([{methodname:"mod_skillsaudit_add_skills",args:{courseid:c,skills:e}}]);b[0].done(function(a){var b=d("#tbl_skills");d.each(a,function(a,c){b.append("<tr class=\"skill_row\" id=\"skill_row_"+c.id+"\"><td class=\"skill_number\"><a class=\"skill_help_link\" href=\""+c.link+"\">"+(0<c.link.length?"<span class=\"info_icon\"></span>":"")+c.number+"</a></td><td class=\"skill_description\">"+c.description+"</td><td><span id=\"skill_included_"+c.id+"\" class=\"skill_included_yes skill_included\"></span></td></tr>");d("#skill_included_"+c.id).click(g);d("#skill_row_"+c.id).dblclick(h)});f();d("#id_newskills").val("")}).fail(function(){d("#skills_preview").html("Could not add skill")})}},{id:"cancel",text:"Cancel",close:!0}])})}};return b});
//# sourceMappingURL=skillsaudit.min.js.map
